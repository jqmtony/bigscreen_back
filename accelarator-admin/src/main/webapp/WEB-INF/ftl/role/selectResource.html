<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<#include "/frame/pageInclude.html">
<script type="text/javascript">
  $(function(){
	  $('#resource_tree').tree({
		  onLoadSuccess: function(node, data){
			  $.ajax({  
				    url:'getSelectedResourceByRoleId',   
				    data:{
				    	roleId:$("#roleId").val()
				    },  
				    type:'post',  
				    dataType:'json',  
				    success:function(data) { 
				        var len = data.length;
				        for(i=0;i<len;i++){
				        	var node = $('#resource_tree').tree('find',data[i].resourceId);
				        	$('#resource_tree').tree('check', node.target);
				        }
				    } 
			   });
		  }
	   });
  });
  
	function saveOk(){
		var nodes = $('#resource_tree').tree('getChecked');
		var resourceIds="";
	    for(i=0;i<nodes.length;i++){
	    	resourceIds+=","+nodes[i].id;
	    }
	    resourceIds = resourceIds.replace(",","");//已经勾选的id字符串
		$.ajax({  
		    url:'saveRoleResource',   
		    data:
		    {
		    	roleId:$("#roleId").val(),
		    	resourceIds:resourceIds
		    },  
		    type:'post',  
		    dataType:'json',  
		    success:function(data) { 
		    	if(data.status){
		        	$.messager.alert('系统提示',"操作成功",'warning',function(){
		        		closes();
					});
		        }else{
		        	$.messager.alert('系统提示',"操作失败"+data.data,'error');
		        } 
		     }
		});
	}
	
	function closes(){
		parent.closeWin();
	}
</script>
</head>
<body>
    <div id="toolbar" style="padding:2px 1px;">
		<form id="queryForm">
		    <input type="hidden" name="roleId" id="roleId" value="${roleId}"/>
			<a href="javascript:void(0);" onclick="saveOk();"class="easyui-linkbutton" iconCls="icon-ok">确定</a>
			<a href="javascript:void(0);" onclick="closes();"class="easyui-linkbutton" iconCls="icon-cancel">关闭</a>
		</form>
	</div>
	
    <div class="easyui-panel" style="padding:5px">
        <ul id="resource_tree" class="easyui-tree" data-options="url:'${base}/resource/queryList',method:'get',checkbox:true,cascadeCheck:false"></ul>
    </div>
	
</body>
</html>
