<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gochinatv.accelarator.dao.DeviceImageDao">

	<resultMap type="com.gochinatv.accelarator.dao.entity.DeviceImage" id="DeviceImage">
		<id property="id" column="id" />
		<result property="mac" column="mac" />
		<result property="imageUrl" column="image_url" />
		<result property="createTime" column="create_time" />
		
		<result property="startTime" column="startTime" />
		<result property="endTime" column="endTime" />
		<result property="deviceName" column="deviceName" />
		<result property="placeName" column="placeName" />
		<result property="name" column="name" />
		
		<result property="countryCode" column="country_code" />
		<result property="areaCode" column="area_code" />
		<result property="cityCode" column="city_code" />
		<result property="duration" column="duration" />
	</resultMap>
	
	<select id="getListByStatEntity" resultMap="DeviceImage" parameterType="DeviceImage">
		select di.mac as mac, count(*)*15 as duration, di.create_time as create_time, 
		p.country_code as country_code, p.area_code as area_code, p.city_code as city_code, 
		d.code as deviceName,p.cname as placeName from device_image di,device d, place p
		<where>
			1=1 and di.mac=d.mac and d.place_id=p.id
			<if test="placeName!=null and placeName!=''">
				and p.cname like CONCAT(CONCAT('%',#{placeName}),'%')
			</if>
			<if test="mac!=null and mac!=''">
				and di.mac like CONCAT(CONCAT('%',#{mac}),'%')
			</if>
			<if test="deviceName!=null and deviceName!=''">
				and d.code like CONCAT(CONCAT('%',#{deviceName}),'%')
			</if>
			<if test="startTime!=null and startTime!=''">
				and di.create_time &gt;= #{startTime} 
			</if>
			<if test="endTime!=null and endTime!=''">
				 and  di.create_time &lt;= #{endTime}
			</if>
			group by di.mac
			order by di.mac asc
		</where>
	</select>
	<select id="getListByEntity" resultMap="DeviceImage" parameterType="DeviceImage">
		select di.id as id,di.mac as mac,di.name as name,di.image_url,d.code as deviceName,p.cname as placeName,di.create_time
		 from device_image di,device d,place p
		<where>
			1=1 and di.mac=d.mac and d.place_id=p.id
			<if test="placeName!=null and placeName!=''">
				and p.cname like CONCAT(CONCAT('%',#{placeName}),'%')
			</if>
			<if test="mac!=null and mac!=''">
				and di.mac like CONCAT(CONCAT('%',#{mac}),'%')
			</if>
			<if test="name!=null and name!=''">
				and di.name like CONCAT(CONCAT('%',#{name}),'%')
			</if>
			<if test="startTime!=null and startTime!=''">
				and di.create_time &gt;= #{startTime} 
			</if>
			<if test="endTime!=null and endTime!=''">
				 and  di.create_time &lt;= #{endTime}
			</if>
			order by di.create_time desc
		</where>
	</select>	
	
	<delete id="deleteById">
		delete from device_image where id=#{id}
	</delete>
</mapper>